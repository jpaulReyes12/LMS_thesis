<dir-admin-nav></dir-admin-nav>

<div class="container">
    <h1 class="big-header">Events</h1>
</div>


<div class="container">
  <div class="admin-controls">

    <div class="col-md-3 col-xs-12">
      <input type="search" class="form-control" placeholder="Search">
    </div>
    <button type="button" class="btn btn-success" ng-click="toggleAdd = !toggleAdd"><span class="fa fa-plus"></span> Add </button>
  </div>
</div>

<div class="container animate-fade" ng-hide="toggleAdd">
  <div class="row col-md-12">


    <div class="well container">

      <form class="form-group col-md-offset-2" name="eventFrm">


        <div class="row others">
          <div class="row others">

            <!-- EVENT NAME -->
            <div class="col-md-4 form-group"
             ng-class="{ 'has-error' : eventFrm.event.$invalid && eventFrm.event.$dirty }">
              <label>Event Name:</label>
              <input type="text" placeholder="Event" class="form-control" name="event" ng-model="event.name" required>
              <p ng-show="eventFrm.event.$error.required && eventFrm.event.$dirty" class="help-block">Event name is required.</p>
            </div>

            <!-- VENUE -->
            <div class="col-md-4">
              <label>Venue:</label>
              <input type="text" placeholder="Venue" class="form-control" name="venue" ng-model="event.venue" >
            </div>
          </div>

          <!-- DESCRIPTION -->
          <div class="row others">
            <div class="col-md-8">
              <label>Description:</label>
              <textarea rows="3" class="form-control" name="description" ng-model="event.description"></textarea>
            </div>

          </div>

          <!-- IMAGE -->
          <div class="row others" style="margin:30px;">

            <label>Image:</label>
            <div class="input-group image-preview col-md-6">
              <input type="text" class="form-control image-preview-filename" disabled="disabled">
              <!-- don't give a name === doesn't send on POST/GET -->
              <span class="input-group-btn">
                <!-- image-preview-clear button -->
                <button type="button" class="btn btn-default image-preview-clear" style="display:none;">
                  <span class="glyphicon glyphicon-remove"></span> Clear
                </button>
                <!-- image-preview-input -->
                <div class="btn btn-default image-preview-input">
                  <span class="glyphicon glyphicon-folder-open"></span>
                  <span class="image-preview-input-title">Browse</span>
                  <input type="file" accept="image/png, image/jpeg, image/gif" name="input-file-preview"/>
                  <!-- rename it -->
                </div>
              </span>
            </div>
          </div>


          <!-- SCHEDULE -->
          <div class="row others">
            <h3>Schedule</h4>

              <!-- START -->
            <div class="col-md-4 form-group"
             ng-class="{ 'has-error' : eventFrm.start.$invalid && eventFrm.start.$dirty }">
              <label>Event start:</label>
              <input type="datetime-local" class="form-control" name="start" min='{{ dateNow | date: "yyyy-MM-ddTHH:mm:ss"}}'
              max='{{ futureDate | date: "yyyy-MM-ddTHH:mm:ss"}}'
              ng-model="event.start" required>

              <p ng-show="eventFrm.start.$invalid && eventFrm.start.$dirty"
             class="help-block">Oops! Event start is invalid.</p>
              <p ng-show="eventFrm.start.$error.max && eventFrm.start.$dirty"
              class="help-block">Don't you think setting this 30+ years into the future is too much?</p>
            </div>

            <!-- END -->
            <div class="col-md-4 form-group"
             ng-class="{ 'has-error' : eventFrm.end.$invalid && eventFrm.end.$dirty }">
              <label>Event end:</label>
              <input type="datetime-local" class="form-control" name="end" min="{{event.start}}"
              max='{{ futureDate | date: "yyyy-MM-ddTHH:mm:ss"}}'
              ng-model="event.end" required>

              <p ng-show="eventFrm.end.$invalid && eventFrm.end.$dirty"
              class="help-block">Oops! Event end is invalid.</p>
              <p ng-show="eventFrm.end.$error.max && eventFrm.end.$dirty"
              class="help-block">Don't you think setting this 30+ years into the future is too much?</p>
              <p ng-show="eventFrm.end.$error.min && eventFrm.end.$dirty"
              class="help-block">Event end must be greater than event start maximum date.</p>
            </div>
          </div>
        </div>

        <button type="button" class=" others btn btn-success pull-right ">
          Submit
        </button>


      </form>
    </div>
  </div>
</div>

<div class="container table-outline table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th><input type="checkbox"></th>
        <th>EventID</th>
        <th>createdOn</th>
        <th>event_start</th>
        <th>event_end</th>
        <th>isActive</th>
        <th>venue</th>
        <th>information</th>
        <th>photo_url</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="checkbox"></td>
        <td>Info</td>
        <td>Info</td>
        <td>Info</td>
        <td>Info</td>
        <td>Info</td>
        <td>Info</td>
        <td>Info</td>
        <td>
          <button type="button" class="btn btn-danger">Deactivate</button>
          <button type="button" class="btn btn-info">Edit</button>
        </td>
      </tr>
  </table>
</div>


<script type="text/javascript">
    $(document).on('click', '#close-preview', function(){
      $('.image-preview').popover('hide');
      // Hover befor close the preview
      $('.image-preview').hover(
          function () {
             $('.image-preview').popover('show');
          },
           function () {
             $('.image-preview').popover('hide');
          }
      );
  });

  $(function() {
      // Create the close button
      var closebtn = $('<button/>', {
          type:"button",
          text: 'x',
          id: 'close-preview',
          style: 'font-size: initial;',
      });
      closebtn.attr("class","close pull-right");
      // Set the popover default content
      $('.image-preview').popover({
          trigger:'manual',
          html:true,
          title: "<strong>Preview</strong>"+$(closebtn)[0].outerHTML,
          content: "There's no image",
          placement:'right'
      });
      // Clear event
      $('.image-preview-clear').click(function(){
          $('.image-preview').attr("data-content","").popover('hide');
          $('.image-preview-filename').val("");
          $('.image-preview-clear').hide();
          $('.image-preview-input input:file').val("");
          $(".image-preview-input-title").text("Browse");
      });
      // Create the preview image
      $(".image-preview-input input:file").change(function (){
          var img = $('<img/>', {
              id: 'dynamic',
              width:250
          });
          var file = this.files[0];
          var reader = new FileReader();
          // Set preview image into the popover data-content
          reader.onload = function (e) {
              $(".image-preview-input-title").text("Change");
              $(".image-preview-clear").show();
              $(".image-preview-filename").val(file.name);
              img.attr('src', e.target.result);
              $(".image-preview").attr("data-content",$(img)[0].outerHTML).popover("show");
          }
          reader.readAsDataURL(file);
      });
  });
</script>
